{% extends "base.html" %}

{% block title %}{{ car.make }} {{ car.model }} - Details{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <!-- Car Images Section -->
        <div class="col-lg-7">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-0">
                    <div class="car-gallery">
                        <img src="{{ car.image_url or url_for('static', filename='images/car-placeholder.jpg') }}" 
                             class="img-fluid rounded-top-3 main-image" 
                             alt="{{ car.make }} {{ car.model }}"
                             id="mainCarImage">
                        {% if car.additional_images %}
                        <div class="thumbnail-container px-3 py-2">
                            {% for img in car.additional_images %}
                            <img src="{{ img }}" class="thumbnail" 
                                 onclick="changeMainImage(this.src)" 
                                 alt="{{ car.make }} {{ car.model }} thumbnail">
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Specifications Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-list-alt me-2"></i>Technical Specifications</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-gas-pump me-2"></i>Fuel Type</span>
                                    <span class="badge bg-primary">{{ car.fuel_type|capitalize }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-cogs me-2"></i>Transmission</span>
                                    <span class="badge bg-primary">{{ car.transmission|capitalize }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-tachometer-alt me-2"></i>Engine</span>
                                    <span class="badge bg-primary">{{ car.engine_capacity }}L</span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-users me-2"></i>Seats</span>
                                    <span class="badge bg-primary">{{ car.seating_capacity }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-car-side me-2"></i>Body Type</span>
                                    <span class="badge bg-primary">{{ car.body_type|capitalize }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-id-card me-2"></i>Registration</span>
                                    <span class="badge bg-primary">{{ car.registration_number }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Booking Section -->
        <div class="col-lg-5">
            <div class="card shadow-sm sticky-booking" style="top: 20px;">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Booking Information</h5>
                </div>
                <div class="card-body">
                    <h3 class="card-title pricing-card-title mb-3">
                        KES {{ "%.2f"|format(car.price_per_day) }}<small class="text-muted fw-light">/day</small>
                    </h3>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Availability:</span>
                            <span class="fw-bold">
                                {% if car.availability %}
                                <span class="text-success">Available</span>
                                {% else %}
                                <span class="text-danger">Unavailable</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Minimum Rental:</span>
                            <span class="fw-bold">2 days</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Insurance:</span>
                            <span class="fw-bold">Included</span>
                        </div>
                    </div>

                    <hr>

                    <h5 class="mb-3">Features & Amenities</h5>
                    <div class="row g-2 mb-4">
                        <div class="col-6">
                            <span class="d-block"><i class="fas fa-check text-success me-2"></i>Air Conditioning</span>
                        </div>
                        <div class="col-6">
                            <span class="d-block"><i class="fas fa-check text-success me-2"></i>Bluetooth</span>
                        </div>
                        <div class="col-6">
                            <span class="d-block"><i class="fas fa-check text-success me-2"></i>Navigation</span>
                        </div>
                        <div class="col-6">
                            <span class="d-block"><i class="fas fa-check text-success me-2"></i>USB Ports</span>
                        </div>
                    </div>

                    <a href="{{ url_for('new_booking', car_id=car.id) }}" 
                       class="btn btn-primary btn-lg w-100 py-3 {% if not car.availability %}disabled{% endif %}">
                        <i class="fas fa-calendar-check me-2"></i> 
                        {% if car.availability %}Book Now{% else %}Not Available{% endif %}
                    </a>

                    <div class="mt-3 text-center">
                        <small class="text-muted">Free cancellation up to 24 hours before pickup</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function changeMainImage(src) {
        document.getElementById('mainCarImage').src = src;
        const thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumb => {
            thumb.classList.remove('active-thumbnail');
            if(thumb.src === src) {
                thumb.classList.add('active-thumbnail');
            }
        });
    }
</script>

<style>
    .car-gallery {
        position: relative;
    }
    
    .main-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
    }
    
    .thumbnail-container {
        display: flex;
        overflow-x: auto;
        gap: 10px;
        background: #f8f9fa;
    }

     .sticky-booking {
        position: -webkit-sticky; 
        position: sticky;
        top: 70px; 
        z-index: 1000;
        transition: all 0.3s ease;
    }

    @media (max-width: 992px) {
        .sticky-booking {
            position: static; 
        }
    }
    
    .thumbnail {
        width: 80px;
        height: 60px;
        object-fit: cover;
        cursor: pointer;
        border: 2px solid transparent;
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .thumbnail:hover {
        border-color: #0d6efd;
    }
    
    .active-thumbnail {
        border-color: #0d6efd;
    }
    
    .star-rating {
        color: #ffc107;
    }
    
    .sticky-top {
        z-index: 1;
    }
    
    @media (max-width: 992px) {
        .main-image {
            height: 300px;
        }
    }
</style>
{% endblock %}